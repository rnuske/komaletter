<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="komaletter">
<title>Parameterized Letters for Mass Mailings • komaletter</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parameterized Letters for Mass Mailings">
<meta property="og:description" content="komaletter">
<meta property="og:image" content="https://rnuske.github.io/komaletter/reference/figures/logo.png">
<meta property="og:image:alt" content="komaletter logo showing a stylized letter">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@rnuske">
<meta name="twitter:site" content="@rnuske">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">komaletter</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.2.901</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/intro.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro.html">Introduction to komaletter</a>
    <a class="dropdown-item" href="../articles/parameterized_letter.html">Parameterized Letters for Mass Mailings</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-examples">Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-examples">
    <a class="dropdown-item" href="../articles/pkgdown_letter_example0.html">Example 0</a>
    <a class="dropdown-item" href="../articles/pkgdown_letter_example1.html">Example 1</a>
    <a class="dropdown-item" href="../articles/pkgdown_letter_example2.html">Example 2</a>
    <a class="dropdown-item" href="../articles/pkgdown_letter_example3.html">Example 3</a>
    <a class="dropdown-item" href="../articles/pkgdown_letter_example4.html">Example 4</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rnuske/komaletter/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Parameterized Letters for Mass Mailings</h1>
                        <h4 data-toc-skip class="author">Robert Nuske</h4>
            
            <h4 data-toc-skip class="date">2022-01-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rnuske/komaletter/blob/HEAD/vignettes/parameterized_letter.Rmd" class="external-link"><code>vignettes/parameterized_letter.Rmd</code></a></small>
      <div class="d-none name"><code>parameterized_letter.Rmd</code></div>
    </div>

    
    
<p>Mail merge is just a variant of R Markdown’s parameterized reports using <code>komaletter</code>. The process is similar to mail merge in traditional word processing applications:</p>
<ul>
<li>write template letter with placeholders (parameters)</li>
<li>compile data on recipients</li>
<li>combine template letter and recipients data</li>
</ul>
<div class="section level2">
<h2 id="tldr-example">TLDR: Example<a class="anchor" aria-label="anchor" href="#tldr-example"></a>
</h2>
<p>Template letter (saved as <code>template_letter.Rmd</code>):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>author<span class="sc">:</span> Max Mustermann</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>return<span class="sc">-</span>address<span class="sc">:</span> [Musterstr. <span class="dv">12</span>, <span class="dv">34567</span> Musterstadt]</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>signature<span class="sc">:</span> Max</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>params<span class="sc">:</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  name<span class="sc">:</span> DefaultNickname</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  address<span class="sc">:</span> <span class="st">"[Default Name, 123 Default St, Default Town]"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  gift<span class="sc">:</span> DefaultGift</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>output<span class="sc">:</span> komaletter<span class="sc">::</span>komaletter</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>address<span class="sc">:</span> <span class="st">`</span><span class="at">r params$address</span><span class="st">`</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>opening<span class="sc">:</span> <span class="st">`</span><span class="at">r paste0('Dear ', params$name, ',')</span><span class="st">`</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>closing<span class="sc">:</span> <span class="st">"Yours truly,"</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>thank you very much <span class="cf">for</span> the beautiful <span class="st">`</span><span class="at">r params$gift</span><span class="st">`</span>. It was a pleasure to have you.</span></code></pre></div>
<p>Collect data about recipients in data.frame <code>recipients</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recipients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Bob"</span>, <span class="st">"Megan"</span>, <span class="st">"Alex"</span><span class="op">)</span>,
                         gift<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"painting"</span>, <span class="st">"candlestick"</span>, <span class="st">"book"</span><span class="op">)</span>,
                         address<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[Robert Pitts, 5543 Aliquet St, Fort Dodge GA 20783]"</span>,
                                   <span class="st">"[Megan Smith, 4156 Tincidunt Ave, Green Bay IN 19759]"</span>,
                                   <span class="st">"[Alexander Fitzgerald, 869 Laurel Ave, St Paul MN 55104]"</span><span class="op">)</span>,
                         stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Combine template letter with recipients’ data and create lots of PDFs:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">recipients</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span><span class="st">"template_letter.Rmd"</span>, 
                    params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="va">recipients</span><span class="op">[</span><span class="va">i</span>, <span class="st">"name"</span><span class="op">]</span>, 
                                gift<span class="op">=</span><span class="va">recipients</span><span class="op">[</span><span class="va">i</span>, <span class="st">"gift"</span><span class="op">]</span>, 
                                address<span class="op">=</span><span class="va">recipients</span><span class="op">[</span><span class="va">i</span>, <span class="st">"address"</span><span class="op">]</span><span class="op">)</span>,
                    output_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"letter_"</span>, <span class="va">recipients</span><span class="op">[</span><span class="va">i</span>, <span class="st">'name'</span><span class="op">]</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basics-of-mail-merge-with-komaletter">Basics of Mail Merge with <code>komaletter</code><a class="anchor" aria-label="anchor" href="#basics-of-mail-merge-with-komaletter"></a>
</h2>
<p>To personalize letters for mass mailings, you can include one or more placeholders (parameters) in a <code>komaletter</code>. These parameters need to be declared first and then put to use later in the document. While rendering the letters, you can assign various values to the parameters.</p>
<div class="section level3">
<h3 id="declaring-parameters">Declaring Parameters<a class="anchor" aria-label="anchor" href="#declaring-parameters"></a>
</h3>
<p>Parameters are declared in the YAML metadata header using the <code>params</code> field. You can specify one or more parameters each on a new line. The default values (below: John &amp; candlestick) given during parameter declaration, will be used if a parameter is not provided during rendering.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>params<span class="sc">:</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  name<span class="sc">:</span> John</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  gift<span class="sc">:</span> candlestick</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>output<span class="sc">:</span> komaletter<span class="sc">::</span>komaletter</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-parameters">Using Parameters<a class="anchor" aria-label="anchor" href="#using-parameters"></a>
</h3>
<p>The declared parameters are automatically made available within the knit environment as components of the read-only list <code>params</code>. For example, the values of the above parameters can be accessed with the following R Code:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params</span><span class="op">$</span><span class="va">name</span>
<span class="va">params</span><span class="op">$</span><span class="va">gift</span></code></pre></div>
<p>If the value of a parameter shall be used in the YAML metadata header, the parameter must be declared previously. Since the backtick ` is a reserved character in YAML, the inline R Code snippet has to be wrapped in quotes.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>params<span class="sc">:</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  name<span class="sc">:</span> John</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  gift<span class="sc">:</span> candlestick</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>subject<span class="sc">:</span> <span class="st">"`r params$gift`"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>output<span class="sc">:</span> komaletter<span class="sc">::</span>komaletter</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="setting-parameter-values">Setting Parameter values<a class="anchor" aria-label="anchor" href="#setting-parameter-values"></a>
</h3>
<p>To set the parameter values, you can add the <code>params</code> argument to <code><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">rmarkdown::render</a></code>. If a parameter does not get a value, the default defined during parameter declaration is used (eg. <code>John</code>, <code>candlestick</code>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span><span class="st">"example.Rmd"</span>, params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Jane"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="challenges-of-mail-merge-with-komaletter">Challenges of Mail Merge with <code>komaletter</code><a class="anchor" aria-label="anchor" href="#challenges-of-mail-merge-with-komaletter"></a>
</h2>
<p>R Markdown and thus <code>komaletter</code> combines R Code, YAML and Markdown. R Markdown documents are processed by <code>knitr</code> to pure YAML and Markdown which in turn is send to pandoc for conversion to the final document type (pdf in this case). A parametrized letter has to obey the restrictions of all parts involved.</p>
<p>The most common personalization are the address of the recipient and the salutation or opening. <code>komaletter</code> expects the address to be a YAML sequence within the YAML metadata header. YAML sequences can be written in flow or block style. Both need quotation marks to protect the square brackets or to enable the escape code <code>\n</code> during parameter declaration in the YAML metadata.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>params<span class="sc">:</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scalar:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  name<span class="sc">:</span> John Doe</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># flow style sequence:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  address_flow<span class="sc">:</span> <span class="st">"[FirstName LastName, 123 Main St, Anytown]"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># block style sequence:</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  address_block<span class="sc">:</span> <span class="st">"</span><span class="sc">\n</span><span class="st">  - FirstName LastName</span><span class="sc">\n</span><span class="st">  - 123 Main St</span><span class="sc">\n</span><span class="st">  - Anytown"</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span></code></pre></div>
<p>Since the address and the letter opening are defined in the YAML metadata. The corresponding parameters must be declared and afterwards put to use within the YAML metadata. Parameter values are accessed in R Code. In the YAML metadata header this means inline code snippets <code>`r expression`</code>. Since backticks <code>`</code> are ‘reserved indicators’ in YAML, the code snippet usually needs to be wrapped in quotes.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>params<span class="sc">:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  name<span class="sc">:</span> John Doe</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>opening<span class="sc">:</span> <span class="st">"`r paste0('Dear ', params$name, ',')`"</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>output<span class="sc">:</span> komaletter<span class="sc">::</span>komaletter</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span></code></pre></div>
<p>The result of the quoted R expression <code>"`r expression`"</code> is a value enclosed in double quotes, i.e. <code>"value"</code>, which is not harmful if the result is of R type character corresponding to a YAML scalar. YAML scalars can be enclosed in single or double quotes or not wrapped at all. But everything in quotes is a scalar to YAML.</p>
<p>Consequently this means that expressions that are supposed to supply an address and thus a YAML sequence, must not be enclosed in quotes! Which poses a main problem since we learned above inline code snippets need to be enclosed in quotes in the main YAML metadata header.</p>
</div>
<div class="section level2">
<h2 id="solution">Solution<a class="anchor" aria-label="anchor" href="#solution"></a>
</h2>
<p>Or rather a <strong>hack</strong> found as bycatch at <a href="https://stackoverflow.com/a/31862074" class="external-link">stackoverflow</a> circumventing the issue at the moment.</p>
<p>As explained above, the address is a YAML sequence and sequences can not be enclosed in quotes. To access the parameter in the main YAML metadata header the inline R Code snippet has to be wrapped in quotes and R expressions wrapped in quotes evaluate to a value enclosed in quotes.</p>
<p>Mysteriously, the rule that backticks must be enclosed in quotes is not enforced in a second YAML metadata block. You can use two metadata blocks because Pandoc combines YAML metadata blocks while converting the .md file to the final document. So in a second metadata block the inline R Code snippet can be written without quotes resulting in a correctly formatted YAML sequence.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>author<span class="sc">:</span> Max Mustermann</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>return<span class="sc">-</span>address<span class="sc">:</span> [Musterstr. <span class="dv">12</span>, <span class="dv">34567</span> Musterstadt]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>signature<span class="sc">:</span> Max</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>params<span class="sc">:</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  name<span class="sc">:</span> Johnny</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  address<span class="sc">:</span> <span class="st">"[John Doe, 123 Main St, Anytown]"</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  gift<span class="sc">:</span> flowers</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>output<span class="sc">:</span> komaletter<span class="sc">::</span>komaletter</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>address<span class="sc">:</span> <span class="st">`</span><span class="at">r params$address</span><span class="st">`</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>opening<span class="sc">:</span> <span class="st">`</span><span class="at">r paste0('Dear ', params$name, ',')</span><span class="st">`</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>closing<span class="sc">:</span> <span class="st">"Yours truly,"</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>thank you very much <span class="cf">for</span> the beautiful <span class="st">`</span><span class="at">r params$gift</span><span class="st">`</span>. It was a pleasure to have you.</span></code></pre></div>
<p>The template letter above can then be called with various values</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recipients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Bob"</span>, <span class="st">"Megan"</span>, <span class="st">"Alex"</span><span class="op">)</span>,
                         gift<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"painting"</span>, <span class="st">"candlestick"</span>, <span class="st">"book"</span><span class="op">)</span>,
                         address<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[Robert Pitts, 5543 Aliquet St, Fort Dodge GA 20783]"</span>,
                                   <span class="st">"[Megan Smith, 4156 Tincidunt Ave, Green Bay IN 19759]"</span>,
                                   <span class="st">"[Alexander Fitzgerald, 869 Laurel Ave, St Paul MN 55104]"</span><span class="op">)</span>,
                         stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>


<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">recipients</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span><span class="st">"template_letter.Rmd"</span>, 
                    params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="va">recipients</span><span class="op">[</span><span class="va">i</span>, <span class="st">"name"</span><span class="op">]</span>, 
                                gift<span class="op">=</span><span class="va">recipients</span><span class="op">[</span><span class="va">i</span>, <span class="st">"gift"</span><span class="op">]</span>, 
                                address<span class="op">=</span><span class="va">recipients</span><span class="op">[</span><span class="va">i</span>, <span class="st">"address"</span><span class="op">]</span><span class="op">)</span>,
                    output_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"letter_"</span>, <span class="va">recipients</span><span class="op">[</span><span class="va">i</span>, <span class="st">'name'</span><span class="op">]</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="further-information">Further Information<a class="anchor" aria-label="anchor" href="#further-information"></a>
</h2>
<ul>
<li>R Markdown
<ul>
<li>
<a href="https://bookdown.org/yihui/rmarkdown/parameterized-reports.html" class="external-link">Chapter “Parametrized Reports”</a> in the book “R Markdown: The Definitive Guide”</li>
<li>
<a href="https://rmarkdown.rstudio.com/lesson-6.html" class="external-link">Lesson 6 “Parameters”</a> in “Get Started”-Course on RStudio’s R Markdown website</li>
</ul>
</li>
<li>YAML
<ul>
<li>
<a href="https://yaml.org/refcard.html" class="external-link">YAML Reference card</a> (Scalar indicators, Escape codes, Misc. Indicators for reserved indicators)</li>
<li>
<a href="https://yaml.org/spec/current.html" class="external-link">YAML Specification</a> (Syntax, Indicator Characters: reserved characters, Escape Sequences, Scalar Styles, Sequence Styles)</li>
<li><a href="https://yaml.org/spec/current.html#id2543032" class="external-link">YAML block sequence</a></li>
<li><a href="https://yaml.org/spec/current.html#id2542413" class="external-link">YAML flow sequence</a></li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="hints">Hints<a class="anchor" aria-label="anchor" href="#hints"></a>
</h2>
<p>Since parameters are evaluated roughly speaking during document knitting (conversion from <code>.Rmd</code> to <code>.md</code>), it is helpful to look at the intermediate <code>.md</code> files to hunt down issues in parameterized letters.</p>
<p>Since <code>komaletter</code> is based on rmarkdown’s output format <code>pdf_document</code>, you can use the argument <code>keep_md</code> to obtain the intermediary <code>.md</code> file (<code>rmarkdown &gt;= 1.14</code>). Previously one had to resort to <code>rmarkdown::render(..., clean=FALSE)</code> to cause the intermediate <code>.md</code> files to remain available.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robert Nuske, Dirk Eddelbuettel, Aaron Wolen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
